{"id":"proj_1768091289536","name":"znnd","mode":"3d","lastModified":1768091412558,"thumbnail":"linear-gradient(135deg, hsl(202, 32%, 15%), hsl(222, 22%, 25%))","scenes":{"scene_initial":{"id":"scene_initial","name":"inicial.clr","objects":[],"camera":{"offset":{"x":380,"y":180},"zoom":0.4275},"engineSettings":{"resolutionScale":1,"backgroundColor":"#14100e","viewportWidth":1600,"viewportHeight":720,"gridEnabled":false,"snapToGrid":false,"gridSize":150,"snapAngle":15,"globalIllumination":1,"zeroGravity":false,"scaleMode":"letterbox"},"data3d":{"version":2,"worldSettings":{"color":"#0e0e14","fogEnabled":false,"fogColor":"#000000","fogDensity":0.05,"sunEnabled":true,"sunColor":"#ffffff","sunIntensity":1,"sunPosition":{"x":5,"y":10,"z":7},"shadowsEnabled":false,"shadowQuality":"medium","gridEnabled":true,"resolutionScale":1,"sky":{"type":"solid","turbidity":10,"rayleigh":3,"mieCoefficient":0.005,"mieDirectionalG":0.7,"elevation":2,"azimuth":180,"exposure":0.5}},"primitives":[{"id":"prim_1768091296226_mhko1","type":"cube","name":"Cubo 1","position":{"x":0,"y":1.6480911967520027,"z":0},"quaternion":{"x":0,"y":0,"z":0,"w":1},"scale":{"x":1,"y":1,"z":1},"color":"#ffffff","texture":null,"textureRepeat":{"x":1,"y":1},"textureTiling":false,"metalness":0,"roughness":0.5,"physics":{"enabled":false,"bodyType":"dynamic","mass":1,"friction":0.5,"restitution":0,"lockRotation":false},"hidden":false,"scripts":[{"id":"script_1768091322866","name":"Controlador Personagem TPS","type":"javascript","content":"// Controlador TPS Completo\n// Requisitos na UI:\n// 1. Joystick (tag: \"joystick\")\n// 2. Slide Area/Touchpad (tag: \"touchpad\")\n// 3. Botão de Pulo (tag: \"btn_jump\")\n// 4. Botão de Correr (tag: \"btn_run\")\n//\n// Configuração do Modelo:\n// - Física: Dinâmico, Travar Rotação: ATIVADO\n// - Animações: \"Idle\", \"Walk\", \"Run\", \"Jump_Start\", \"Jump_Loop\", \"Jump_End\"\n\nfunction start() {\n    // --- Configurações de Movimento ---\n    this.walkSpeed = 5.0;\n    this.runSpeed = 12.0; \n    this.rotateSpeed = 15.0;\n    this.jumpForce = 8.0; \n    \n    // Inverter Eixos do Joystick\n    this.invertX = true; \n    this.invertY = true;\n\n    // --- Câmera ---\n    // Busca a câmera principal da cena\n    this.camera = scene.getObjectByProperty(\"isCamera\", true);\n    this.camDist = 3.5;   \n    this.camHeight = 1.8; \n    this.yaw = Math.PI; \n    this.pitch = 0.2;\n    this.sensitivity = 0.005; \n\n    // --- Animações (Edite os nomes aqui) ---\n    this.animIdle = \"Idle\";\n    this.animWalk = \"Walk\";\n    this.animRun = \"Run\";\n    this.animJumpStart = \"Jump_Start\"; // Inicio do pulo\n    this.animJumpLoop = \"Jump_Loop\";   // Caindo\n    this.animJumpEnd = \"Jump_End\";     // Aterrisando\n    \n    // Estado Interno\n    this.isGrounded = false;\n    this.wasGrounded = false;\n    this.jumpPressed = false;\n    this.landTimer = 0; // Tempo travado na animação de pouso\n    \n    // Inicia parado\n    if(this.animation) this.animation.play(this.animIdle, 0.2);\n}\n\nfunction update(dt) {\n    if (!object.physics) return;\n\n    // --- 1. CÂMERA (Touchpad) ---\n    const touch = Input.getTouchpad(\"touchpad\");\n    if (touch.deltaX !== 0 || touch.deltaY !== 0) {\n        this.yaw -= touch.deltaX * this.sensitivity;\n        this.pitch += touch.deltaY * this.sensitivity;\n    }\n    // Limita o ângulo vertical\n    this.pitch = Math.max(-0.5, Math.min(1.2, this.pitch));\n    \n    // Posiciona Câmera\n    if (this.camera) {\n        const target = object.position.clone().add(new THREE.Vector3(0, this.camHeight, 0));\n        const hDist = this.camDist * Math.cos(this.pitch);\n        const camX = target.x + hDist * Math.sin(this.yaw);\n        const camZ = target.z + hDist * Math.cos(this.yaw);\n        const camY = target.y + this.camDist * Math.sin(this.pitch);\n        this.camera.position.set(camX, camY, camZ);\n        this.camera.lookAt(target);\n    }\n\n    // --- 2. CHECAGEM DE CHÃO (Apenas para animação) ---\n    const vel = object.physics.getVelocity();\n    // Verifica se a velocidade vertical é quase zero\n    this.isGrounded = Math.abs(vel.y) < 0.1;\n\n    // Lógica de Aterrisagem\n    if (this.isGrounded && !this.wasGrounded) {\n        // Toca animação de pouso\n        if(this.animation) this.animation.play(this.animJumpEnd, 0.1);\n        this.landTimer = 0.4; // Fica um tempo na animação\n    }\n    this.wasGrounded = this.isGrounded;\n\n    if (this.landTimer > 0) this.landTimer -= dt;\n\n    // --- 3. INPUT MOVIMENTO ---\n    const joy = Input.getJoystick(\"joystick\");\n    const inputX = joy.x * (this.invertX ? -1 : 1);\n    const inputY = joy.y * (this.invertY ? -1 : 1);\n    const direction = new THREE.Vector3(inputX, 0, inputY); \n    const isMoving = direction.length() > 0.1;\n    const isRunning = Input.isButtonPressed(\"btn_run\");\n    const currentSpeed = isRunning ? this.runSpeed : this.walkSpeed;\n\n    // --- 4. INPUT PULO (LIVRE) ---\n    // Permite pulo no ar, mas exige soltar o botão para pular de novo\n    const btnJump = Input.isButtonPressed(\"btn_jump\");\n    \n    if (btnJump && !this.jumpPressed) {\n        // Aplica força para cima\n        // Zera velocidade Y para pulo consistente no ar\n        object.physics.setVelocity(vel.x, 0, vel.z);\n        object.physics.applyImpulse(0, this.jumpForce, 0);\n        \n        if(this.animation) this.animation.play(this.animJumpStart, 0.1);\n        \n        this.isGrounded = false; // Sai do chão imediatamente\n        this.landTimer = 0;      // Cancela pouso\n    }\n    this.jumpPressed = btnJump; // Trava o botão até soltar\n\n    // --- 5. APLICAÇÃO DE MOVIMENTO E ANIMAÇÃO ---\n    \n    // Animação de queda (Loop)\n    if (!this.isGrounded && vel.y < -0.5) {\n        if(this.animation) this.animation.play(this.animJumpLoop, 0.2);\n    }\n\n    if (isMoving) {\n        // Se mover, cancela animação de pouso\n        this.landTimer = 0; \n\n        // Calcula direção relativa à câmera\n        direction.applyAxisAngle(new THREE.Vector3(0,1,0), this.yaw + Math.PI);\n        direction.normalize();\n        \n        // Move o personagem\n        object.physics.setVelocity(direction.x * currentSpeed, object.physics.getVelocity().y, direction.z * currentSpeed);\n        \n        // Gira o personagem suavemente\n        const targetAngle = Math.atan2(direction.x, direction.z);\n        const targetQuat = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0), targetAngle);\n        object.quaternion.slerp(targetQuat, this.rotateSpeed * dt);\n        \n        // Animação de andar/correr (se estiver no chão)\n        if (this.isGrounded) {\n            const animName = isRunning ? this.animRun : this.animWalk;\n            if(this.animation) this.animation.play(animName, 0.2);\n        }\n    } else {\n        // Parar movimento horizontal\n        object.physics.setVelocity(0, object.physics.getVelocity().y, 0);\n        \n        // Animação parado (se estiver no chão e não estiver pousando)\n        if (this.isGrounded && this.landTimer <= 0) {\n            if(this.animation) this.animation.play(this.animIdle, 0.2);\n        }\n    }\n}"},{"id":"script_1768091354874","name":"Girar Objeto","type":"javascript","content":"// Girar Objeto\n// Gira constantemente no eixo Y\n\nfunction start() {\n    // Vetor apontando para cima (Eixo Y)\n    this.axis = new THREE.Vector3(0, 1, 0);\n    this.speed = 1.0; // Radianos por segundo\n}\n\nfunction update(deltaTime) {\n    // Rotaciona o objeto no eixo definido\n    if (typeof object.rotateOnAxis === 'function') {\n        object.rotateOnAxis(this.axis, this.speed * deltaTime);\n    }\n}"}]}],"models":[],"camera":{"position":{"x":0,"y":1.6232324612172482,"z":5},"quaternion":{"x":0,"y":0,"z":0,"w":1},"parentId":null,"fov":60},"lights":{"point":[],"spot":[]},"ui":[]}}}}